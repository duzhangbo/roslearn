<?xml version="1.0"?>
<robot name="$(arg roboname)" xmlns:xacro="http://www.ros.org/wiki/xacro" >
    <xacro:property name="PI" value="3.1415926835897931"/>
<!--定义宏变量提高利用率-->
    <xacro:property name="base_length" value="2.695"/>
    <xacro:property name="base_width" value="0.68"/>
    <xacro:property name="base_height" value="1.370"/>
    <xacro:property name="base_collision_height" value="0.875"/>
    <xacro:property name="base_mass" value="956"/>
    <xacro:property name="base_mass_ixx" value="343"/>
    <xacro:property name="base_mass_iyy" value="728"/>
    <xacro:property name="base_mass_izz" value="772"/>
    

    <xacro:property name="rear_tyre_x" value="0.945"/>
    <xacro:property name="rear_tyre_y" value="0.642"/>
    <xacro:property name="rear_tyre_r" value="0.3"/>
    <xacro:property name="rear_tyre_length" value="0.165"/>
    <xacro:property name="rear_tyre_mass" value="20"/>
    <xacro:property name="rear_tyre_mass_ixx" value="0.5"/>
    <xacro:property name="rear_tyre_mass_iyy" value="0.9"/>
    <xacro:property name="rear_tyre_mass_izz" value="0.5"/>

    <xacro:property name="front_tyre_x" value="0.923"/>
    <xacro:property name="front_tyre_y" value="0.642"/>
    <xacro:property name="front_tyre_r" value="0.3"/>
    <xacro:property name="front_tyre_length" value="0.165"/>
    <xacro:property name="front_tyre_mass" value="20"/>
    <xacro:property name="front_tyre_mass_ixx" value="0.5"/>
    <xacro:property name="front_tyre_mass_iyy" value="0.9"/>
    <xacro:property name="front_tyre_mass_izz" value="0.5"/>

    <xacro:property name="str_angle" value="0.6"/>
    <xacro:property name="str_length" value="0.01"/>
    <xacro:property name="str_radius" value="0.1"/>
    <xacro:property name="str_mass" value="5"/>
    <xacro:property name="str_mass_ixx" value="0.012"/>
    <xacro:property name="str_mass_iyy" value="0.025"/>
    <xacro:property name="str_mass_izz" value="0.012"/>

<!--汽车身体，用定义的长宽高， ${base_collision_height}是将车向上抬起一点点-->

<link name="base_link">
    <collision>
        <origin xyz="0 0 ${base_collision_height}" rpy="0 0 0"/>
        <geometry>
            <box size="${base_length} ${base_width} ${base_height}"/>
        </geometry>
    </collision>

    <visual>
        <origin xyz="0 0 ${base_collision_height}" rpy="0 0 0"/>
        <geometry>
            <box size="${base_length} ${base_width} ${base_height}"/>
        </geometry>
    </visual>
</link>

<joint name="inertial_joint" type="fixed">
    <parent link="base_link"/>
    <child link="main_mass"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
</joint>

<link name="main_mass" type="fixed">
    <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${base_mass}"/>
        <inertia
            ixx="${base_mass_ixx}" ixy="0" ixz="0"
            iyy="${base_mass_iyy}" iyz="0"
            izz="${base_mass_izz}"
        />
    </inertial>
</link>


<!--车的右后轮，有自己的碰撞体积，外观定义，还有质量转动惯量，continuous连续的关节（车轮驱动），revolute是0～90转动（前轮转向）-->
<!--右后轮是怎样和车身进行连接，通过一个类型为连续的joint关节连接-->
<joint name="rear_right_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="rear_right_wheel_link"/>
    <origin xyz="${-rear_tyre_x} ${-rear_tyre_y} ${rear_tyre_r}"/>
    <axis xyz="0 1 0"/>
    <dynamics damping="0.1"/>
    <limit effort="100000" velocity="10000"/>
    <joint_prorerties damping="0.0" friction="0.0"/>

</joint>
<!--定义车的零件-->
<link name="rear_right_wheel_link">
    <collision>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${rear_tyre_length}" radius="rear_tyre_r"/>
        </geometry>
    </collision>
    <visual>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${rear_tyre_length}" radius="${rear_tyre_r}"/>
        </geometry>
    </visual>
<!--质量可以写在一个相同的link里-->
    <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${rear_tyre_mass}"/>
        <inertia
            ixx="${rear_tyre_mass_ixx}" ixy="0" ixz="0"
            iyy="${rear_tyre_mass_iyy}" iyz="0"
            izz="${rear_tyre_mass_izz}"
        />
    </inertial>
</link>

<!--左后轮和右后轮类似，${-rear_tyre_x}通过符号进行对称-->
<joint name="rear_left_wheel_joint" type="continuous">
    <parent link="base_link"/>
    <child link="rear_left_wheel_link"/>
    <origin xyz="${-rear_tyre_x} ${rear_tyre_y} ${rear_tyre_r}" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <dynamics damping="0.1"/>
    <limit effort="100000" velocity="10000"/>
    <joint_prorerties damping="0.0" friction="0.0"/>

</joint>

<link name="rear_left_wheel_link">
    <collision>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${rear_tyre_length}" radius="${rear_tyre_r}"/>
        </geometry>

    </collision>

    <visual>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${rear_tyre_length}" radius="${rear_tyre_r}"/>
        </geometry>
    </visual>

    <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${rear_tyre_mass}"/>
        <inertia
            ixx="${rear_tyre_mass_ixx}" ixy="0" ixz="0"
            iyy="${rear_tyre_mass_iyy}" iyz="0"
            izz="${rear_tyre_mass_izz}"
        />
    </inertial>

</link>


<!--steering为前轮中心的一个转向的小圆盘，通过将轮子附在上面进行转向的-->

<joint name="front_right_steering_joint" type="revolute">
    <parent link="base_link"/>
    <child link="front_right_steering_link"/>
    <origin xyz="${front_tyre_x} -${front_tyre_y} ${front_tyre_r}" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="${-str_angle}" upper="${str_angle}" effort="1000000" velocity="10000"/>
    <dynamics damping="10.0" friction="0.0"/>

</joint>

<link name="front_right_steering_link">
    <visual>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${str_length}" radius="${str_radius}"/>
        </geometry>
    </visual>
    <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${str_mass}"/>
        <inertia
            ixx="${str_mass_ixx}" ixy="0" ixz="0"
            iyy="${str_mass_iyy}" iyz="0"
            izz="${str_mass_izz}"
        />
    </inertial>

</link>

<joint name="front_right_wheel_joint" type="continuous">
    <parent link="front_right_steering_link"/>
    <child link="front_right_wheel_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <dynamics damping="0.1"/>
    <limit effort="1000000" velocity="10000"/>
    <joint_prorerties damping="0.0" friction="0.0"/>
</joint>

<link name="front_right_wheel_link">
    <collision>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${front_tyre_length}" radius="${front_tyre_r}"/>
        </geometry>
    </collision>

    <visual>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${front_tyre_length}" radius="${front_tyre_r}"/>
        </geometry>
    </visual>

    <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${front_tyre_mass}"/>
        <inertia
            ixx="${front_tyre_mass_ixx}" ixy="0" ixz="0"
            iyy="${front_tyre_mass_iyy}" iyz="0"
            izz="${front_tyre_mass_izz}"
        />
    </inertial>

</link>

<!--与右前轮类似-->
<joint name="front_left_steering_joint" type="revolute">
    <parent link="base_link"/>
    <child link="front_left_steering_link"/>
    <origin xyz="${front_tyre_x} ${front_tyre_y} ${front_tyre_r}" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="${-str_angle}" upper="${str_angle}" effort="1000000" velocity="10000"/>
    <dynamics damping="10.0" friction="0.0"/>

</joint>

<link name="front_left_steering_link">
    <visual>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${str_length}" radius="${str_radius}"/>
        </geometry>
    </visual>

    <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${str_mass}"/>
        <inertia
            ixx="${str_mass_ixx}" ixy="0" ixz="0"
            iyy="${str_mass_iyy}" iyz="0"
            izz="${str_mass_izz}"
        />
    </inertial>

</link>

<joint name="front_left_wheel_joint" type="continuous">
    <parent link="front_left_steering_link"/>
    <child link="front_left_wheel_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <dynamics damping="0.1"/>
    <limit effort="1000000" velocity="10000"/>
    <joint_prorerties damping="0" friction="0"/>

</joint>

<link name="front_left_wheel_link">
    <collision>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${front_tyre_length}" radius="${front_tyre_r}"/>
        </geometry>
    </collision>

    <visual>
        <origin xyz="0 0 0" rpy="${PI/2} 0 0"/>
        <geometry>
            <cylinder length="${front_tyre_length}" radius="${front_tyre_r}"/>
        </geometry>

    </visual>

    <inertial>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <mass value="${front_tyre_mass}"/>
        <inertia
            ixx="${front_tyre_mass_ixx}" ixy="0" ixz="0"
            iyy="${front_tyre_mass_iyy}" iyz="0"
            izz="${front_tyre_mass_izz}"
        />

    </inertial>

</link>

</robot>